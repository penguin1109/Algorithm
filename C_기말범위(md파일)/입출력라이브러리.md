### 13장. 입출력 라이브러리
#### 스트림(stream)과 표준 입출력
- 스트림은 연속된 데이터 바이트의 흐름이다.
- 입출력을 위해서는 스트림이 형성 되어야만 한다.
- 스트림기반의 입출력은 버퍼를 경유한 입출력으로 수행된다.
  - 입력 : 키보드로부터 입력된 내용을 임시로 버퍼에 저장했다가 읽기 명령 수행시에 프로그램으로 전달한다.

#### scanf()함수와 %c, fflush(), %d
1. scanf()와 %c
   - %c와 scanf()가 함께 쓰일 경우 흔히 우리가 'ENTER'키를 누름으로서 생성되는 공백 **문자**를 scanf()는 하나의 문자로 받아들이기 때문에 결국에 우리가 입력한 문자와 달리 공백 문자를 저장하게 될 것이다.
   - 이를 위해서 중간에 ENTER키를 입력할 getchar()을 사용한다.
2. scanf()와 %d
   - Leading 공백 문자 : skip and flush
   - 공백 문자로 숫자의 끝 인식
   - Ending 공백 문자 : leave
```c
int main(void){
    char ch;
    int num1, num2, num3;
    scanf("%d", &num1);
    scanf("%d", &num2);
    getchar();
    scanf("%c", &ch);

    printf("\n");
    printf("num1 = %d\n", num1);
    printf("num2 = %d\n", num2);
    printf("ch = %c", ch);

    return 0;
}
```

#### 파일 입출력
1. 파일 열기
   - 파일 입출력을 수행하려면 가장 먼저 fopen() 함수를 호출해서 파일을 열어야 한다.
   - fopen()의 파라미터로 **파일명**과 **파일 열기 모드**를 지정하면 해당 파일에 대한 파일 스트림을 생성하고, 생성된 파일 스트림에 대한 파일 포인터를 리턴한다.
```c
FILE *fopen(const char* filename, const char* mode);
```  
    - r : 입력용 파일을 연다. (파일이 없으면 열기 실패이다)
    - w : 출력용 파일을 연다. (파일이 없으면 새로 생성하고, 기존 파일이 있으면 파일 내용이 모두 사라진다.)
    - b : 바이너리 모드에서 입출력을 수행한다.  

1. 파일 닫기
   - 파일의 입출력이 끝나면 fclose 함수를 호출하여 파일을 닫는다. 
   - fclose 함수는 파라미터로 파일 포인터를 지정하며, 파일 닫기가 성공하면 0을 return하고 실패하면 EOF(-1)을 return 한다.
```c
int fclose(FILE* stream)
```
3. 스트림 상태 확인
   - ferror() 함수는 파일 입출력시 발생하는 에러를 확인한다.
     - 에러 발생시에 0이 아닌 값을 return하고, 에러가 발생하지 않았으면 0을 return 한다.
```c
int ferror(FILE* stream)
``` 
   - feof() 함수는 파일의 끝인지를 검사한다.
     - 끝이면 0이 아닌 값을 return하고, 그렇지 않으면 0을 return 한다.
```c
int feof(FILE* stream)
```  

4. 텍스트 파일 입출력
```c
int main(void){
    int a = 0;
    FILE* fp = NULL;
    fp = fopen("infile.txt", "r");
    //파일로 출력하기 위해 수정해야 하는 공간 fp2
    fp2 = fopen("aveage.txt", "w");

    //fscanf와 fprintf모두 scanf, printf와 동일하게 사용이 되지만 앞에 파일의 포인터를 붙인다는 점이 다르다.
    fscanf(fp, "%d", &a);
    fprintf(fp2, "ID = %d", a);

    fclose(fp);
    fclose(fp2);

    return 0;
}
```

5. 바이너리 파일의 입출력
- 중간 결과를 우리가 변수에, 즉 메모리에 저장하게 되는데 메모리 부족을 막기 위해서 새로운 파일에 중간 결과를 입출력 할 수 있도록 한다.
- fread(), fwrite() 함수를 사용한다.
  - fread() : 파일에서 버퍼로 binary data를 읽어온다.
```c
size_t fread(void *buffer, size_t size, size_t count, FILE* stream)
```  
  -  fwrite() : 파일에 버퍼의 내용을 binary data로 저장한다.
```c
size_t fwrite(void *buffer, size_t size, size_t count, FILE* stream) ;
```

```c
#include <stdio.h>
#define MAX_STUD 5

int main(void){
    int ID, korean, math, english,i,j;
    int result[5];
    int result2[5];
    FILE *fp = NULL, *fp2 = NULL, *fp3 = NULL;
    fp = fopen("scores.txt", "r");
    //"wb"는 write binary file이라는 뜻
    fp2 = fopen("average.dat", "wb");

    if (fp != NULL){
        for (i = 0;i<MAX_STUD;i++){
            fscanf(fp, "%d %d %d %d", &ID, &korean, &math, &english);
            result[0] = ID;
            result[1] = korean;
            result[2] = math;
            result[3] = english;
            result[4] = (korean+math+english)/3;
            fwrite(result, sizeof(int), 5, fp2);
        }
        //data가 저장된 .txt 파일
        fclose(fp);
        //binary file
        fclose(fp2);
    }
    //fp2를 fclose() 했기 떄문에 fopen이 binary 입력용으로 average.dat파일을 열어서 재사용하는 것이 가능하다.
    fp3 = fopen("average.dat", "rb");
    if (fp3 != NULL){
        for (i = 0;i<MAX_STUD;i++){
            //fread() 함수를 이용해서 정수 5개가 들어있는 배열을 fp3이 가리키는 파일에서 읽어서 배열 result2[5]에 저장한다.
            fread(result2, sizeof(int), 5, fp3);
            for (j = 0;j<5;j++){
                if (j==0){
                    printf("ID = %d", result2[j]);
                }
                else{
                    printf("%5d", result2[j]);
                }
            }
            printf("\n");
        }
        fclose(fp3);
    }
    return 0;
}
```
